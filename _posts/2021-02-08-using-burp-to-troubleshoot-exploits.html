---
layout: post
status: publish
published: true
title: Using Burp Proxy to Troubleshoot Web Exploits
author:
  display_name: oncybersec
  url: ''
wordpress_id: 142
wordpress_url: https://oncybersec.com/?p=142
date: '2021-02-08 10:04:55 +0200'
date_gmt: '2021-02-08 08:04:55 +0200'
tags:
- penetration testing
- oscp
- burp suite
comments: []
---
<p><!-- wp:paragraph --></p>
<p>When running web exploits against a target, there are times where the exploit may fail to work and the output from the terminal may not give a descriptive error as to what the issue may be. The Burp Suite proxy can be used to troubleshoot why the exploit may not be working by running the exploit through a proxy. This will allow you to view the requests and responses that are sent/received when running the exploit. The benefit is that this will work even if the exploit does not provide a command-line option to specify a proxy. In addition to troubleshooting web exploits, another benefit of running exploits through the Burp proxy is that it enables you to log all the requests/responses you have sent/received, which helps keep track of the actions you have performed during a pentest. This demonstration will show you how to run the <a href="{{site.url}}/automating-sql-injection/" target="_blank" rel="noreferrer noopener">time_blind_sqli.sh</a> script through the Burp proxy. The time_blind_sqli.sh script will be run against <a rel="noreferrer noopener" href="https://dvwa.co.uk/" target="_blank">DVWA</a> to exploit a blind SQL injection vulnerability in the id GET parameter and requires that the user is authenticated. We start by running the below command:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":278,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.url}}/assets/images/figure_1_no_cookie.png" alt="" class="wp-image-278"/></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>The output of the script indicates that there are no results, but we are certain that it should work as the id GET parameter is vulnerable. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading --></p>
<h2>Configuring Proxy Listener</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Let’s create a new proxy listener in Burp that redirects to DVWA:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list --></p>
<ul>
<li>In Burp, go to <strong>Proxy &gt; Options &gt; Proxy Listeners &gt; Add &gt; Binding</strong> and set ‘Bind to port’ to 8081</li>
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:image {"id":280,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.url}}/assets/images/figure_2_binding.png" alt="" class="wp-image-280"/></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:list --></p>
<ul>
<li>Select the ‘Request handling’ tab:
<ul>
<li>Set ‘Redirect to host’ to the IP address of your target (in my case 192.168.56.101)</li>
<li>Set ‘Redirect to port’ to 80 (443 if the target is using HTTPS) and click OK</li>
</ul>
</li>
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:image {"id":281,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.url}}/assets/images/figure_3_request_handling.png" alt="" class="wp-image-281"/></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:list --></p>
<ul>
<li>Also, make sure that the Burp proxy interceptor is off under <strong>Proxy &gt; Intercept</strong></li>
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:heading --></p>
<h2>Running Exploit via Burp Proxy</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Let’s rerun the time_blind_sqli.sh script, this time replacing the hostname with the Burp proxy host and port we configured above, which will run the script through the Burp proxy:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":282,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.url}}/assets/images/figure_4_exploit_via_proxy.png" alt="" class="wp-image-282"/></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>In Burp, navigating to <strong>Proxy &gt; HTTP history</strong> displays all the requests/responses that have been sent/received by the script. Looking at the response in the below screenshot indicates an HTTP redirect (302 Found) to the ../../login.php page, which indicates that we must be authenticated for the exploit to work.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":283,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.url}}/assets/images/figure_5_http_redirect.png" alt="" class="wp-image-283"/></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Informed by the above information, we would then log into DVWA and use Burp to intercept the request and obtain the cookie. Rerunning the time_blind_sqli.sh script using the cookie (with security=low) results in the successful extraction of the current database:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":284,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.url}}/assets/images/figure_6_exploit_with_cookie.png" alt="" class="wp-image-284"/></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>By using the Burp proxy, we were able to troubleshoot the time_blind_sqli.sh script and identify that the issue was due to a missing cookie.</p>
<p><!-- /wp:paragraph --></p>
