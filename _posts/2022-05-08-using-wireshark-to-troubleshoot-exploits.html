---
layout: post
status: publish
published: true
title: Using Wireshark to Troubleshoot Exploits
author:
  display_name: oncybersec
  url: ''
wordpress_id: 768
wordpress_url: https://oncybersec.com/?p=768
date: '2022-05-08 15:15:48 +0200'
date_gmt: '2022-05-08 13:15:48 +0200'
tags:
- penetration testing
- oscp
- wireshark
comments: []
---
<p><!-- wp:paragraph --></p>
<p><a rel="noreferrer noopener" href="{{site.url}}/wireshark-introduction/" target="_blank">Wireshark</a> has many use cases that are not only limited to networking. One example is using it to troubleshoot exploits, which makes it a useful addition to a pentester's toolset. This post will demonstrate how to use Wireshark to troubleshoot a <a rel="noreferrer noopener" href="https://www.exploit-db.com/exploits/50457" target="_blank">phpMyAdmin remote code execution exploit</a> (CVE-2018-12613). Burp Suite can also be used to troubleshoot exploits and this has been covered in a <a href="{{site.url}}/using-burp-to-troubleshoot-exploits/" target="_blank" rel="noreferrer noopener">previous post</a>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>We start by running the exploit without any parameters to identify its usage and required parameters:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"center","id":769,"sizeSlug":"full","linkDestination":"none"} --></p>
<div class="wp-block-image">
<figure class="aligncenter size-full"><img src="{{site.url}}/assets/images/figure_1_exploit_usage.png" alt="Exploit usage" class="wp-image-769"/></figure>
</div>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>All of the above parameters are required to run the exploit. We will be running the exploit against a vulnerable instance of phpMyAdmin (192.168.1.101), which is running version 4.8.1.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"center","id":770,"sizeSlug":"full","linkDestination":"none"} --></p>
<div class="wp-block-image">
<figure class="aligncenter size-full"><img src="{{site.url}}/assets/images/figure_2_phpmyadmin.png" alt="phpMyAdmin login page" class="wp-image-770"/></figure>
</div>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>The phpMyAdmin instance is using the credentials <code>root:P@ssw0rd</code>, which we provide to the exploit and then run it:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"center","id":771,"sizeSlug":"full","linkDestination":"none"} --></p>
<div class="wp-block-image">
<figure class="aligncenter size-full"><img src="{{site.url}}/assets/images/figure_3_exploit_fail.png" alt="Exploit fail" class="wp-image-771"/></figure>
</div>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>However, in the above screenshot, the exploit returns the message: <code>Unable to find the version</code> and was not successful as it did not return the output of the <code>whoami</code> command. To troubleshoot this, let's use Wireshark to view the network traffic that is sent by the exploit. We start a live capture using Wireshark and add the filter <code>tcp.port == 8080</code> to only show phpMyAdmin traffic. Next, the exploit is rerun again with the same parameters as before and the phpMyAdmin traffic now appears in Wireshark:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"center","id":772,"sizeSlug":"full","linkDestination":"none"} --></p>
<div class="wp-block-image">
<figure class="aligncenter size-full"><img src="{{site.url}}/assets/images/figure_4_live_capture.png" alt="Wireshark live capture" class="wp-image-772"/></figure>
</div>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>We also see a GET request that was made to <code>/phpmyadmin/index.php</code>. Let's view the related packets by right-clicking on the request and selecting <strong>Follow </strong>><strong> HTTP Stream</strong>:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"center","id":774,"sizeSlug":"full","linkDestination":"none"} --></p>
<div class="wp-block-image">
<figure class="aligncenter size-full"><img src="{{site.url}}/assets/images/figure_5_http_stream.png" alt="Wireshark HTTP stream" class="wp-image-774"/></figure>
</div>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Here we can see that an HTTP 404 status code was returned in the response:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"center","id":775,"sizeSlug":"full","linkDestination":"none"} --></p>
<div class="wp-block-image">
<figure class="aligncenter size-full"><img src="{{site.url}}/assets/images/figure_6_http_404.png" alt="HTTP 404 response" class="wp-image-775"/></figure>
</div>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>This suggests that the <code>/phpmyadmin/index.php</code> path does not exist on the server. Relooking at the phpMyAdmin instance path and the path provided as an argument to the exploit, we can see that they don't match:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"center","id":776,"sizeSlug":"full","linkDestination":"none"} --></p>
<div class="wp-block-image">
<figure class="aligncenter size-full"><img src="{{site.url}}/assets/images/figure_7_phpmyadmin_path.png" alt="phpMyAdmin path" class="wp-image-776"/></figure>
</div>
<p><!-- /wp:image --></p>
<p><!-- wp:image {"align":"center","id":777,"sizeSlug":"full","linkDestination":"none"} --></p>
<div class="wp-block-image">
<figure class="aligncenter size-full"><img src="{{site.url}}/assets/images/figure_8_exploit_path.png" alt="Exploit path" class="wp-image-777"/></figure>
</div>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>So it looks like the path provided to the exploit was not correct. We set the exploit path to <code>/index.php</code> and rerun it. The exploit now runs successfully and we can see the output of the <code>whoami</code> command that is <code>www-data</code>:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"center","id":778,"sizeSlug":"full","linkDestination":"none"} --></p>
<div class="wp-block-image">
<figure class="aligncenter size-full"><img src="{{site.url}}/assets/images/figure_9_exploit_working.png" alt="Exploit working" class="wp-image-778"/></figure>
</div>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Though this example may seem contrived, it highlights an important aspect of exploits: the output returned by a non-working exploit may not always point to the underlying issue. This is where being able to view the network traffic that was generated by an exploit with Wireshark can help facilitate troubleshooting. This is because it may include useful information that may not be found in the exploit output on the command line.</p>
<p><!-- /wp:paragraph --></p>
